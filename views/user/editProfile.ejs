<%- include('../partials/user/header') %>



<link href="/css/bootstrap.min.css" rel="stylesheet">
<script src="/js/bootstrap.bundle.min.js"></script>

 



<style>
    /* Custom Grid Styling */
    .grid-container {
        display: grid;
        grid-template-columns: repeat(4, 1fr); /* Four columns for a row layout */
        gap: 2rem; /* Space between grid items */
        padding: 2rem;
        margin: 0 auto;
        max-width: 1200px; /* Adjust as needed */
    }

    .grid-item {
        background-color: white;
        padding: 1.5rem;
        border-radius: 0.75rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .grid-item h1,
    .grid-item h2,
    .grid-item h5,
    .grid-item label {
        color: black;
    }

    .grid-item input {
        background-color: white;
        color: black;
    }

    .full-width {
        grid-column: span 4; /* Span across all four columns */
        text-align: center;
    }

    @media (max-width: 768px) {
        .grid-container {
            grid-template-columns: 1fr; /* Single column on small screens */
        }

        .full-width {
            grid-column: span 1;
        }
    }
</style>

<body style="background-color: white;">
    <br>

    <div class="grid-container">
        <!-- Profile Picture Section -->
        <div class="grid-item full-width">
            <h2 class="text-3xl font-bold text-center text-amber-500 mb-6">Edit Profile</h2>
            <div class="flex flex-col items-center mb-8">
                <img id="profilePhoto" 
                     src="<%= userData.photo ? userData.photo : 'images/Messi signup.jpg' %>"
                     class="w-32 h-32 md:w-40 md:h-40 rounded-full border-4 border-amber-500 object-cover mb-4 transition-transform duration-300 hover:scale-105 shadow-lg"
                     alt="Profile Photo">

                <form id="profilePicForm" data-user-id="<%= userData._id %>" class="text-center" enctype="multipart/form-data">
                    <input type="file" id="profileImage" name="profileImage" accept="image/*" class="hidden" >
                    <button type="button" 
                            onclick="document.getElementById('profileImage').click()"
                            class="bg-blue-300 hover:bg-blue-500 text-gray-900 font-semibold py-2 px-4 rounded-xl transition-all duration-300 shadow-md hover:shadow-xl">
                        <i class="fas fa-camera mr-2"></i>Change Photo
                    </button>
                </form>
            </div>
        </div>

        <!-- Personal Information Form -->
        <div class="grid-item">
            <h2 class="text-2xl font-bold mb-4">Personal Information</h2>
            <form id="editProfileForm" action="/userProfile/edit/<%= userData._id %>" method="POST" class="space-y-4">
                <!-- Name -->
                <div class="space-y-2">
                    <h5 class="block text-gray-400">Name</h5>
                    <input type="text" 
                           name="name" 
                           value="<%= userData.name %>"
                           class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-gray-100 focus:outline-none focus:ring-2 focus:ring-amber-400 focus:border-transparent transition-all duration-300 shadow-inner" 
                           required>
                </div>

                <!-- Username -->
                <div class="space-y-2">
                    <h5 class="block text-gray-400">User Name</h5>
                    <input type="text" 
                           name="username" 
                           value="<%= userData.username %>"
                           class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-gray-100 focus:outline-none focus:ring-2 focus:ring-amber-400 focus:border-transparent transition-all duration-300 shadow-inner" 
                           required>
                </div>

                <!-- Phone Number -->
                <div class="space-y-2">
                    <label class="block text-gray-400">Phone Number</label>
                    <input type="tel" 
                           name="phone" 
                           value="<%= userData.phone %>"
                           class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-gray-100 focus:outline-none focus:ring-2 focus:ring-amber-400 focus:border-transparent transition-all duration-300 shadow-inner">
                </div>

                <button type="submit" 
                        class="bg-blue-300 hover:bg-blue-500 text-gray-900 font-semibold py-2 px-4 rounded-xl transition-all duration-300 shadow-md hover:shadow-xl">
                    Save Changes
                </button>
            </form>
        </div>

        <!-- Change Email -->
        <div class="grid-item">
            <h2 class="text-2xl font-bold mb-4">Change Email</h2>
            <form action="/userProfile/edit/<%= userData._id %>" method="POST" class="space-y-4">
                <div class="space-y-2">
                    <label class="block text-gray-400">Email</label>
                    <input type="email" 
                           name="email" 
                           value="<%= userData.email %>"
                           class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-gray-100 focus:outline-none focus:ring-2 focus:ring-amber-400 focus:border-transparent transition-all duration-300 shadow-inner">
                </div>

                <button type="submit" 
                        class="bg-blue-300 hover:bg-blue-500 text-gray-900 font-semibold py-2 px-4 rounded-xl transition-all duration-300 shadow-md hover:shadow-xl">
                    Change Your Email
                </button>
            </form>
        </div>

        <!-- Change Password -->
        <div class="grid-item">
            <h2 class="text-2xl font-bold mb-4">Change Password</h2>
            <form id="changePasswordForm" action="/userProfile/change-password/<%= userData._id %>" method="POST" class="space-y-4">
                <div class="space-y-2">
                    <label class="block text-gray-400">Current Password</label>
                    <input id="currentPassword" 
                           type="password" 
                           name="currentPassword" 
                           class="form-control w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-gray-100 focus:outline-none focus:ring-2 focus:ring-amber-400 focus:border-transparent transition-all duration-300 shadow-inner">
                    <small id="currentPasswordError" class="text-danger"></small>
                </div>

                <div class="space-y-2">
                    <label class="block text-gray-400">New Password</label>
                    <input type="password" 
                           name="newPassword" 
                           class="form-control w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-gray-100 focus:outline-none focus:ring-2 focus:ring-amber-400 focus:border-transparent transition-all duration-300 shadow-inner">
                </div>

                <div class="space-y-2">
                    <label class="block text-gray-400">Confirm New Password</label>
                    <input type="password" 
                           name="confirmPassword" 
                           class="form-control w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-gray-100 focus:outline-none focus:ring-2 focus:ring-amber-400 focus:border-transparent transition-all duration-300 shadow-inner">
                </div>

                <button type="submit" 
                        class="bg-blue-300 hover:bg-blue-500 text-gray-900 font-semibold py-2 px-4 rounded-xl transition-all duration-300 shadow-md hover:shadow-xl">
                    Change Password
                </button>
            </form>
        </div>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


</body>


<script>


    const form = document.getElementById('profilePicForm');
    const userId = form.dataset.userId;


    document.getElementById('profileImage').addEventListener('change', function (e) {
        const file = e.target.files[0];
        if (!file) return;


        const formData = new FormData();
        formData.append('profileImage', file);

        fetch(`/upload-profile-pic/${userId}`, {
            method: 'POST',
            body: formData
        })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                  
                    document.getElementById("profilePhoto").src = data.imagePath;

                    Swal.fire('Success!', 'Profile picture updated successfully.', 'success');
                } else {
                    Swal.fire('Error!', 'Failed to upload image.', 'error');
                }
            })
            .catch(error => Swal.fire('Error!', 'Something went wrong.', 'error'));
    });



</script>
